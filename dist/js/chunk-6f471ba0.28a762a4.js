(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f471ba0"],{"04d1":function(t,e,n){var i=n("342f"),o=i.match(/firefox\/(\d+)/i);t.exports=!!o&&+o[1]},2532:function(t,e,n){"use strict";var i=n("23e7"),o=n("5a34"),s=n("1d80"),r=n("577e"),a=n("ab13");i({target:"String",proto:!0,forced:!a("includes")},{includes:function(t){return!!~r(s(this)).indexOf(r(o(t)),arguments.length>1?arguments[1]:void 0)}})},"25f0":function(t,e,n){"use strict";var i=n("6eeb"),o=n("825a"),s=n("577e"),r=n("d039"),a=n("ad6d"),c="toString",u=RegExp.prototype,l=u[c],d=r((function(){return"/a/b"!=l.call({source:"a",flags:"b"})})),f=l.name!=c;(d||f)&&i(RegExp.prototype,c,(function(){var t=o(this),e=s(t.source),n=t.flags,i=s(void 0===n&&t instanceof RegExp&&!("flags"in u)?a.call(t):n);return"/"+e+"/"+i}),{unsafe:!0})},"4e82":function(t,e,n){"use strict";var i=n("23e7"),o=n("1c0b"),s=n("7b0b"),r=n("50c4"),a=n("577e"),c=n("d039"),u=n("addb"),l=n("a640"),d=n("04d1"),f=n("d998"),p=n("2d00"),h=n("512ce"),g=[],v=g.sort,m=c((function(){g.sort(void 0)})),k=c((function(){g.sort(null)})),x=l("sort"),y=!c((function(){if(p)return p<70;if(!(d&&d>3)){if(f)return!0;if(h)return h<603;var t,e,n,i,o="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)g.push({k:e+i,v:n})}for(g.sort((function(t,e){return e.v-t.v})),i=0;i<g.length;i++)e=g[i].k.charAt(0),o.charAt(o.length-1)!==e&&(o+=e);return"DGBEFHACIJK"!==o}})),b=m||!k||!x||!y,w=function(t){return function(e,n){return void 0===n?-1:void 0===e?1:void 0!==t?+t(e,n)||0:a(e)>a(n)?1:-1}};i({target:"Array",proto:!0,forced:b},{sort:function(t){void 0!==t&&o(t);var e=s(this);if(y)return void 0===t?v.call(e):v.call(e,t);var n,i,a=[],c=r(e.length);for(i=0;i<c;i++)i in e&&a.push(e[i]);a=u(a,w(t)),n=a.length,i=0;while(i<n)e[i]=a[i++];while(i<c)delete e[i++];return e}})},"512ce":function(t,e,n){var i=n("342f"),o=i.match(/AppleWebKit\/(\d+)\./);t.exports=!!o&&+o[1]},"5a34":function(t,e,n){var i=n("44e7");t.exports=function(t){if(i(t))throw TypeError("The method doesn't accept regular expressions");return t}},"763c":function(t,e,n){},"787e":function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{width:"250px"}},[n("div",{staticClass:"titleBox"},[n("span",{staticClass:"title"},[t._v("已选方案")]),n("span",{staticClass:"stats"},[t._v("已选作品数目："+t._s(t.voteInfo.length)),n("br"),t._v("待选作品数目："+t._s(t.contestConfig.maxVotesNum-t.voteInfo.length))])]),n("div",{staticClass:"selectedBox"},[t._l(t.voteInfo,(function(e,i){return[null!==e?[n("div",{key:i,staticClass:"selectedWorkBox"},[n("div",{staticStyle:{width:"148.5px",height:"210px"}},[n("el-image",{attrs:{src:e.imgList[0],lazy:""},on:{click:function(n){return n.stopPropagation(),t.jumpToDetailHandler(e)}}})],1),n("div",{staticStyle:{"margin-top":"5px",display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"}},[n("span",{staticClass:"tipText"},[t._v(t._s(e.workIdx)+" - "+t._s(e.name))])])])]:t._e()]}))],2),n("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[n("el-button",{staticStyle:{width:"48%"},attrs:{type:"primary",icon:"el-icon-collection-tag",disabled:t.userInfo.isDone||1===t.revote},on:{click:t.saveTemp}},[t._v("保存进度")]),n("el-button",{staticStyle:{width:"48%"},attrs:{type:"success",icon:"el-icon-collection-tag",disabled:t.userInfo.isDone||1===t.revote},on:{click:t.submitVote}},[t._v("提交结果")])],1)])},o=[],s=n("5530"),r=(n("a15b"),n("2f62")),a=n("f8c8"),c={name:"Selected",data:function(){return{intervalIdx:0}},computed:Object(s["a"])({},Object(r["b"])(["userInfo","voteInfo","contestConfig","votedWorks","revote"])),beforeDestroy:function(){this.saveTemp(),clearInterval(this.intervalIdx)},mounted:function(){var t=this;this.intervalIdx=setInterval((function(){t.userInfo.isDone||t.saveTemp()}),3e5)},methods:Object(s["a"])(Object(s["a"])({},Object(r["c"])(["updateVoteInfo","updateUserInfo"])),{},{jumpToDetailHandler:function(t){this.$router.push({path:"/detail/"+t.workID})},saveTemp:function(){var t=this,e={round_id:this.contestConfig.roundID,voted_works:this.votedWorks.join(","),round_idx:this.contestConfig.roundIdx};this.userInfo.isDone||Object(a["j"])(e).then((function(){t.$message({type:"success",message:"保存成功！"})})).catch((function(){t.$message({type:"error",message:"保存失败！"})}))},submitVote:function(){var t=this;this.$confirm("提交结果后不可再次修改，确认提交吗？","",{confirmButtonText:"提交",cancelButtonText:"取消",type:"warning"}).then((function(){var e={round_id:t.contestConfig.roundID,voted_works:t.votedWorks.join(","),round_idx:t.contestConfig.roundIdx};Object(a["l"])(e).then((function(){t.$message({type:"success",message:"保存成功！"});var e=t.userInfo;e.isDone=!0,t.updateUserInfo(e)})).catch((function(){t.$message({type:"error",message:"保存失败！"})}))}))}})},u=c,l=(n("ab67"),n("2877")),d=Object(l["a"])(u,i,o,!1,null,"5517364e",null);e["a"]=d.exports},a15b:function(t,e,n){"use strict";var i=n("23e7"),o=n("44ad"),s=n("fc6a"),r=n("a640"),a=[].join,c=o!=Object,u=r("join",",");i({target:"Array",proto:!0,forced:c||!u},{join:function(t){return a.call(s(this),void 0===t?",":t)}})},a434:function(t,e,n){"use strict";var i=n("23e7"),o=n("23cb"),s=n("a691"),r=n("50c4"),a=n("7b0b"),c=n("65f0"),u=n("8418"),l=n("1dde"),d=l("splice"),f=Math.max,p=Math.min,h=9007199254740991,g="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!d},{splice:function(t,e){var n,i,l,d,v,m,k=a(this),x=r(k.length),y=o(t,x),b=arguments.length;if(0===b?n=i=0:1===b?(n=0,i=x-y):(n=b-2,i=p(f(s(e),0),x-y)),x+n-i>h)throw TypeError(g);for(l=c(k,i),d=0;d<i;d++)v=y+d,v in k&&u(l,d,k[v]);if(l.length=i,n<i){for(d=y;d<x-i;d++)v=d+i,m=d+n,v in k?k[m]=k[v]:delete k[m];for(d=x;d>x-i+n;d--)delete k[d-1]}else if(n>i)for(d=x-i;d>y;d--)v=d+i-1,m=d+n-1,v in k?k[m]=k[v]:delete k[m];for(d=0;d<n;d++)k[d+y]=arguments[d+2];return k.length=x-i+n,l}})},ab13:function(t,e,n){var i=n("b622"),o=i("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[o]=!1,"/./"[t](e)}catch(i){}}return!1}},ab67:function(t,e,n){"use strict";n("e28f")},addb:function(t,e){var n=Math.floor,i=function(t,e){var r=t.length,a=n(r/2);return r<8?o(t,e):s(i(t.slice(0,a),e),i(t.slice(a),e),e)},o=function(t,e){var n,i,o=t.length,s=1;while(s<o){i=s,n=t[s];while(i&&e(t[i-1],n)>0)t[i]=t[--i];i!==s++&&(t[i]=n)}return t},s=function(t,e,n){var i=t.length,o=e.length,s=0,r=0,a=[];while(s<i||r<o)s<i&&r<o?a.push(n(t[s],e[r])<=0?t[s++]:e[r++]):a.push(s<i?t[s++]:e[r++]);return a};t.exports=i},b811:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-container",{staticStyle:{"margin-top":"16px",height:"calc(100vh - 120px)"}},[t.revote?[n("el-main",{staticStyle:{height:"100%",width:"100%",padding:"0",display:"flex","justify-content":"center"}},[n("OverviewComp")],1)]:[n("el-main",{staticStyle:{height:"100%",width:"100%",padding:"0",display:"flex","justify-content":"center"}},[n("OverviewComp")],1),n("el-aside",{staticStyle:{height:"100%",display:"flex","justify-content":"center"}},[n("Selected")],1)]],2)],1)},o=[],s=n("5530"),r=n("787e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{width:"96%"}},[n("div",{staticClass:"titleBox"},[n("span",{staticClass:"title"},[t.revote?[n("div",{staticStyle:{display:"flex","align-items":"center"}},[n("span",[t._v(" 平票重投 ")]),n("span",{staticStyle:{"font-size":"16px",display:"flex","align-items":"center"}},[t._v(" （"+t._s(t.revoteWorks.total)+" 进 "+t._s(t.revoteWorks.promoted_num-t.revoteWorks.promotion_num)+"） "),n("div",{staticStyle:{"font-size":"12px","line-height":"12px",display:"flex","flex-direction":"column"}},[n("div",[t._v(" 截止时间："+t._s(t.revoteEndDateTime)+" ")]),n("div",[t._v(" 当前时间："+t._s(t.curDateTime)+" ")])])])])]:[t._v(" 全部方案 ")]],2),n("div",[n("el-tabs",{attrs:{"tab-position":"bottom"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[t._l(t.contestConfig.roundInfo,(function(e,i){return[n("el-tab-pane",{key:i,attrs:{label:e.round_desc,name:e.round_index.toString(),disabled:t.contestConfig.roundIdx!==e.round_index}})]}))],2)],1)]),n("div",{staticClass:"workContainer",staticStyle:{"flex-direction":"column"}},[t._l(t.sliceList(t.works,5),(function(e,i){return[n("div",{key:i,staticClass:"workRow",staticStyle:{width:"100%",display:"flex","justify-content":"space-evenly"}},[t._l(e,(function(e,i){return[t.revote?[n("div",{key:i,staticClass:"workBox",class:e.checked?"workBoxChecked":"",on:{click:function(n){return t.handleRevote(e)}}},[n("div",{staticClass:"imgNCheckBox"},[n("div",[n("el-checkbox",{attrs:{disabled:1e3*t.revoteWorks.expire<=(new Date).getTime()},on:{click:function(t){if(t.target!==t.currentTarget)return null;t.preventDefault()}},model:{value:e.checked,callback:function(n){t.$set(e,"checked",n)},expression:"item.checked"}})],1),n("div",{staticStyle:{width:"148.5px",height:"210px"}},[n("el-image",{attrs:{src:e.cover_img,lazy:"","preview-src-list":e.img_list},on:{click:function(t){t.stopPropagation()}}})],1)]),n("div",{staticStyle:{"margin-top":"10px",display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",width:"100%"}},[n("span",{staticClass:"workName"},[t._v(t._s(e.user_idx)+" - "+t._s(e.work_name))]),n("span",{staticClass:"tipText"},[t._v("当前票数："+t._s(e.votes))])])])]:[n("div",{key:i,staticClass:"workBox",class:e.checked?"workBoxChecked":"",on:{click:function(n){return t.workBoxClickHandler(e)}}},[n("div",{staticClass:"imgNCheckBox"},[n("div",[n("el-checkbox",{attrs:{disabled:t.userInfo.isDone||t.contestConfig.maxVotesNum===t.votedWorks.length&&!e.checked},on:{click:function(t){if(t.target!==t.currentTarget)return null;t.preventDefault()}},model:{value:e.checked,callback:function(n){t.$set(e,"checked",n)},expression:"item.checked"}})],1),n("div",{staticStyle:{width:"148.5px",height:"210px"}},[n("el-image",{attrs:{src:e.imgList[0],lazy:""},on:{click:function(n){return n.stopPropagation(),t.jumpToDetailHandler(e)}}})],1)]),n("div",{staticStyle:{"margin-top":"10px",display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",width:"100%"}},[n("span",{staticClass:"workName"},[t._v(t._s(e.workIdx)+" - "+t._s(e.name))]),n("span",{staticClass:"tipText"},[t._v("点击图片查看作品详情")])])])]]}))],2)]}))],2),n("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[1===t.revote?[n("el-pagination",{attrs:{disabled:"",layout:"total, sizes","page-size":t.num,total:t.total,"page-sizes":[10,20,50]},on:{"size-change":t.sizeChangeHandler,"update:pageSize":function(e){t.num=e},"update:page-size":function(e){t.num=e},"update:total":function(e){t.total=e}}}),n("el-pagination",{attrs:{disabled:"",layout:"prev, pager, next, jumper","current-page":t.page,"page-size":t.num,total:t.total,"page-sizes":[5,10,20,50]},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.pageChangeHandler,"update:pageSize":function(e){t.num=e},"update:page-size":function(e){t.num=e},"update:total":function(e){t.total=e}}})]:[n("el-pagination",{attrs:{layout:"total, sizes","page-size":t.num,total:t.contestConfig.totalWorkNum,"page-sizes":[10,20,50]},on:{"size-change":t.sizeChangeHandler,"update:pageSize":function(e){t.num=e},"update:page-size":function(e){t.num=e},"update:total":function(e){return t.$set(t.contestConfig,"totalWorkNum",e)}}}),n("el-pagination",{attrs:{layout:"prev, pager, next, jumper","current-page":t.page,"page-size":t.num,total:t.contestConfig.totalWorkNum,"page-sizes":[5,10,20,50]},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.pageChangeHandler,"update:pageSize":function(e){t.num=e},"update:page-size":function(e){t.num=e},"update:total":function(e){return t.$set(t.contestConfig,"totalWorkNum",e)}}})]],2)])},c=[],u=(n("d3b7"),n("25f0"),n("159b"),n("a434"),n("a15b"),n("4e82"),n("c740"),n("caad"),n("2532"),n("fb6a"),n("b0c0"),n("2f62")),l=n("f8c8"),d={name:"Overview",data:function(){return{page:1,num:10,total:0,works:[],curTime:0}},computed:Object(s["a"])(Object(s["a"])({},Object(u["b"])(["voteInfo","votedWorks","contestConfig","userInfo","revote","revoteWorks","revoteVotedWorks"])),{},{activeName:function(){return this.contestConfig.roundIdx.toString()},sliceList:function(){return function(t,e){var n=0,i=[];if(void 0!==t)for(var o=0;o<t.length;o++)n=parseInt(o/e),i.length<=n&&i.push([]),i[n].push(t[o]);return i}},revoteEndDateTime:function(){var t=new Date(1e3*this.revoteWorks.expire),e=function(t){return t<10?"0"+t:t},n=t.getFullYear(),i=e(t.getMonth()+1),o=e(t.getDate()),s=e(t.getHours()),r=e(t.getMinutes()),a=e(t.getSeconds());return n+"-"+i+"-"+o+" "+s+":"+r+":"+a},curDateTime:function(){var t=new Date(this.curTime),e=function(t){return t<10?"0"+t:t},n=t.getFullYear(),i=e(t.getMonth()+1),o=e(t.getDate()),s=e(t.getHours()),r=e(t.getMinutes()),a=e(t.getSeconds());return n+"-"+i+"-"+o+" "+s+":"+r+":"+a}}),watch:{revote:function(){this.getData()}},mounted:function(){var t,e,n=this;this.ws.handleVotes=function(t){n.works.forEach((function(e){e.user_id===t.data.user_id&&(e.votes=t.data.votes)})),n.sortWork()},this.curTime=(new Date).getTime(),setInterval((function(){n.curTime+=1e3}),1e3),this.page=~~(null!==(t=this.$route.query["page"])&&void 0!==t?t:1),this.num=~~(null!==(e=this.$route.query["num"])&&void 0!==e?e:10),this.getData()},methods:Object(s["a"])(Object(s["a"])({},Object(u["c"])(["updateVoteInfo","updateVotedWorks","updateRevoteVotedWorks"])),{},{pageChangeHandler:function(t){var e=location.pathname+"?page="+t+"&num="+this.num;history.pushState({url:e,title:document.title},document.title,e),this.page=t,this.getData()},sizeChangeHandler:function(t){var e=location.pathname+"?page="+this.page+"&num="+t;history.pushState({url:e,title:document.title},document.title,e),this.num=t,this.getData()},workBoxClickHandler:function(t){this.userInfo.isDone?this.$message({type:"warning",message:"已经提交过了，不能再更改了！"}):this.votedWorks.length!==this.contestConfig.maxVotesNum||t.checked?(t.checked=!t.checked,this.checkChangeHandler(t)):this.$message({type:"warning",message:"不能再选了！"})},jumpToDetailHandler:function(t){this.$router.push({path:"/detail/"+t.workID})},handleRevote:function(t){if(1e3*this.revoteWorks.expire<=this.curTime)this.$message({type:"warning",message:"重投已截止！"});else{t.checked=!t.checked;var e=this.revoteVotedWorks;if(t.checked){t.votes++;var n=this.revoteVotedWorks;n.push(t.user_id),this.updateRevoteVotedWorks(n);var i={code:20021,msg:"Revote info.",data:this.revoteVotedWorks.join(",")};this.ws.ws.send(JSON.stringify(i))}else{t.votes--,e.splice(e.indexOf(t.user_id),1),this.updateRevoteVotedWorks(e);var o={code:20021,msg:"Revote info.",data:this.revoteVotedWorks.join(",")};this.ws.ws.send(JSON.stringify(o))}this.sortWork()}},sortWork:function(){this.works.sort((function(t,e){return e.votes===t.votes?t.user_id-e.user_id:e.votes-t.votes}))},checkChangeHandler:function(t){var e=this.voteInfo,n=this.votedWorks;t.checked?(e.push(t),e.sort((function(t,e){return t.workID-e.workID})),n.push(t.workID),n.sort((function(t,e){return t-e}))):(e.splice(e.findIndex((function(e){return e.workID===t.workID})),1),n.splice(n.indexOf(t.workID),1)),this.updateVoteInfo(e),this.updateVotedWorks(n)},getData:function(){var t=this;if(this.revote){var e=this.revoteWorks.promotion_info;return e.forEach((function(e){t.revoteVotedWorks.includes(e.user_id)?e.checked=!0:e.checked=!1,e.cover_img=e.img_list[0].slice(0,e.img_list[0].lastIndexOf("."))+"_compressed"+e.img_list[0].slice(e.img_list[0].lastIndexOf("."),e.img_list[0].length)})),this.works=e,this.total=this.works.length,void this.sortWork()}var n={page:this.page,num:this.num,round_idx:this.contestConfig.roundIdx};Object(l["c"])(n).then((function(e){var n=e.data;n.forEach((function(e){var n;t.votedWorks.includes(e.workID)?e.checked=!0:e.checked=!1,""===e.name&&(e.name="测试"),(null===(n=!e.imgList)||void 0===n||n)&&(e.imgList=["https://ivillages-images.oss-cn-qingdao.aliyuncs.com/1/static/imgs/test.png"]),e.imgList.forEach((function(t,n){e.imgList[n]=t.slice(0,t.lastIndexOf("."))+"_compressed"+t.slice(t.lastIndexOf("."),t.length)}))})),t.works=n}))}})},f=d,p=(n("f825"),n("2877")),h=Object(p["a"])(f,a,c,!1,null,"5cca0684",null),g=h.exports,v={name:"Overview",components:{Selected:r["a"],OverviewComp:g},computed:Object(s["a"])({},Object(u["b"])(["revote"]))},m=v,k=Object(p["a"])(m,i,o,!1,null,"1f1e02df",null);e["default"]=k.exports},c740:function(t,e,n){"use strict";var i=n("23e7"),o=n("b727").findIndex,s=n("44d2"),r="findIndex",a=!0;r in[]&&Array(1)[r]((function(){a=!1})),i({target:"Array",proto:!0,forced:a},{findIndex:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),s(r)},caad:function(t,e,n){"use strict";var i=n("23e7"),o=n("4d64").includes,s=n("44d2");i({target:"Array",proto:!0},{includes:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),s("includes")},d998:function(t,e,n){var i=n("342f");t.exports=/MSIE|Trident/.test(i)},e28f:function(t,e,n){},f825:function(t,e,n){"use strict";n("763c")},fb6a:function(t,e,n){"use strict";var i=n("23e7"),o=n("861d"),s=n("e8b5"),r=n("23cb"),a=n("50c4"),c=n("fc6a"),u=n("8418"),l=n("b622"),d=n("1dde"),f=d("slice"),p=l("species"),h=[].slice,g=Math.max;i({target:"Array",proto:!0,forced:!f},{slice:function(t,e){var n,i,l,d=c(this),f=a(d.length),v=r(t,f),m=r(void 0===e?f:e,f);if(s(d)&&(n=d.constructor,"function"!=typeof n||n!==Array&&!s(n.prototype)?o(n)&&(n=n[p],null===n&&(n=void 0)):n=void 0,n===Array||void 0===n))return h.call(d,v,m);for(i=new(void 0===n?Array:n)(g(m-v,0)),l=0;v<m;v++,l++)v in d&&u(i,l,d[v]);return i.length=l,i}})}}]);
//# sourceMappingURL=chunk-6f471ba0.28a762a4.js.map